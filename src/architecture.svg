<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 460 880" font-family="'Inter','Helvetica Neue',sans-serif" font-size="12">
  <defs>
    <marker id="arrow" markerWidth="7" markerHeight="5" refX="7" refY="2.5" orient="auto">
      <path d="M0,0 L7,2.5 L0,5" fill="#888"/>
    </marker>
    <style>
      .box  { fill: #1a1a2e; stroke: #444; stroke-width: 1.2; rx: 8; }
      .attn { fill: #1a2e1a; stroke: #4a7; stroke-width: 1.2; rx: 8; }
      .mlp  { fill: #2e251a; stroke: #c84; stroke-width: 1.2; rx: 8; }
      .norm { fill: #241a2e; stroke: #86c; stroke-width: 1.2; rx: 8; }
      .label    { font-size: 12px; font-weight: 600; text-anchor: middle; fill: #ddd; }
      .sublabel { font-size: 9px;  text-anchor: middle; fill: #888; }
      .dim      { font-size: 9px;  text-anchor: start;  fill: #666; font-family: monospace; }
      .conn     { stroke: #555; stroke-width: 1.2; marker-end: url(#arrow); fill: none; }
      .skip     { stroke: #555; stroke-width: 1; stroke-dasharray: 4,3; marker-end: url(#arrow); fill: none; }
      .block-label { font-size: 10px; text-anchor: middle; fill: #555; font-style: italic; letter-spacing: 1px; }
    </style>
  </defs>

  <!-- Background -->
  <rect width="460" height="880" fill="#111118" rx="12"/>

  <!-- Title -->
  <text x="230" y="30" class="label" font-size="15" fill="#eee">MicroGPT Forward Pass</text>
  <text x="230" y="46" class="sublabel" font-size="10">1 layer · 4 heads · dim 16 · char-level</text>

  <!-- Legend -->
  <rect x="16" y="24" width="10" height="10" class="attn"/>
  <text x="32" y="33" class="sublabel" text-anchor="start">Attn</text>
  <rect x="16" y="38" width="10" height="10" class="mlp"/>
  <text x="32" y="47" class="sublabel" text-anchor="start">MLP</text>
  <rect x="16" y="52" width="10" height="10" class="norm"/>
  <text x="32" y="61" class="sublabel" text-anchor="start">Norm</text>

  <!-- Input -->
  <rect x="155" y="66" width="150" height="32" class="box"/>
  <text x="230" y="84" class="label">token_id</text>
  <text x="230" y="94" class="sublabel">int</text>
  <line x1="230" y1="98" x2="230" y2="114" class="conn"/>

  <!-- Embeddings -->
  <rect x="100" y="114" width="120" height="30" class="box"/>
  <text x="160" y="132" class="label">W<tspan baseline-shift="sub" font-size="9">te</tspan>[tok]</text>
  <rect x="240" y="114" width="120" height="30" class="box"/>
  <text x="300" y="132" class="label">W<tspan baseline-shift="sub" font-size="9">pe</tspan>[pos]</text>

  <!-- Sum embeddings -->
  <line x1="160" y1="144" x2="230" y2="160" class="conn"/>
  <line x1="300" y1="144" x2="230" y2="160" class="conn"/>
  <circle cx="230" cy="166" r="10" fill="#1a1a2e" stroke="#555" stroke-width="1.2"/>
  <text x="230" y="170" class="label" font-size="12">+</text>
  <line x1="230" y1="176" x2="230" y2="192" class="conn"/>

  <!-- RMSNorm -->
  <rect x="160" y="192" width="140" height="28" class="norm"/>
  <text x="230" y="210" class="label">RMSNorm</text>
  <text x="312" y="210" class="dim">[16]</text>
  <line x1="230" y1="220" x2="230" y2="240" class="conn"/>

  <!-- Transformer block outline -->
  <rect x="50" y="234" width="360" height="418" rx="10" fill="none" stroke="#333" stroke-width="1" stroke-dasharray="5,4"/>
  <text x="230" y="252" class="block-label">TRANSFORMER BLOCK</text>

  <!-- RMSNorm 2 -->
  <rect x="160" y="260" width="140" height="28" class="norm"/>
  <text x="230" y="278" class="label">RMSNorm</text>
  <line x1="230" y1="288" x2="230" y2="304" class="conn"/>

  <!-- QKV projections -->
  <line x1="230" y1="304" x2="120" y2="314" class="conn"/>
  <line x1="230" y1="304" x2="230" y2="314" class="conn"/>
  <line x1="230" y1="304" x2="340" y2="314" class="conn"/>

  <rect x="70" y="314" width="100" height="28" class="attn"/>
  <text x="120" y="332" class="label">W<tspan baseline-shift="sub" font-size="9">Q</tspan> · x</text>

  <rect x="180" y="314" width="100" height="28" class="attn"/>
  <text x="230" y="332" class="label">W<tspan baseline-shift="sub" font-size="9">K</tspan> · x</text>

  <rect x="290" y="314" width="100" height="28" class="attn"/>
  <text x="340" y="332" class="label">W<tspan baseline-shift="sub" font-size="9">V</tspan> · x</text>

  <!-- Converge to attention -->
  <line x1="120" y1="342" x2="230" y2="360" class="conn"/>
  <line x1="230" y1="342" x2="230" y2="360" class="conn"/>
  <line x1="340" y1="342" x2="230" y2="360" class="conn"/>

  <!-- Attention -->
  <rect x="120" y="360" width="220" height="40" class="attn"/>
  <text x="230" y="378" class="label">Scaled Dot-Product Attn</text>
  <text x="230" y="389" class="sublabel">q<tspan baseline-shift="sub" font-size="7">i</tspan> · k<tspan baseline-shift="sub" font-size="7">j</tspan> / √d → softmax → Σ α<tspan baseline-shift="sub" font-size="7">t</tspan>v<tspan baseline-shift="sub" font-size="7">t</tspan></text>
  <line x1="230" y1="392" x2="230" y2="408" class="conn"/>

  <!-- Output projection -->
  <rect x="155" y="408" width="150" height="28" class="attn"/>
  <text x="230" y="426" class="label">W<tspan baseline-shift="sub" font-size="9">O</tspan> · x</text>
  <text x="316" y="426" class="dim">[16]</text>

  <!-- Residual 1 -->
  <line x1="230" y1="436" x2="230" y2="448" class="conn"/>
  <path d="M 68 274 L 68 454 L 218 454" class="skip"/>
  <circle cx="230" cy="454" r="9" fill="#1a1a2e" stroke="#555" stroke-width="1.2"/>
  <text x="230" y="458" class="label" font-size="11">+</text>
  <line x1="230" y1="463" x2="230" y2="478" class="conn"/>

  <!-- RMSNorm 3 -->
  <rect x="160" y="478" width="140" height="28" class="norm"/>
  <text x="230" y="496" class="label">RMSNorm</text>
  <line x1="230" y1="506" x2="230" y2="520" class="conn"/>

  <!-- MLP -->
  <rect x="145" y="520" width="170" height="28" class="mlp"/>
  <text x="230" y="538" class="label">W<tspan baseline-shift="sub" font-size="9">fc1</tspan> · x</text>
  <text x="326" y="538" class="dim">[64]</text>
  <line x1="230" y1="548" x2="230" y2="558" class="conn"/>

  <rect x="175" y="558" width="110" height="24" class="mlp"/>
  <text x="230" y="574" class="label">ReLU</text>
  <line x1="230" y1="582" x2="230" y2="592" class="conn"/>

  <rect x="145" y="592" width="170" height="28" class="mlp"/>
  <text x="230" y="610" class="label">W<tspan baseline-shift="sub" font-size="9">fc2</tspan> · x</text>
  <text x="326" y="610" class="dim">[16]</text>

  <!-- Residual 2 -->
  <line x1="230" y1="620" x2="230" y2="634" class="conn"/>
  <path d="M 392 468 L 392 640 L 242 640" class="skip"/>
  <circle cx="230" cy="640" r="9" fill="#1a1a2e" stroke="#555" stroke-width="1.2"/>
  <text x="230" y="644" class="label" font-size="11">+</text>
  <line x1="230" y1="649" x2="230" y2="670" class="conn"/>

  <!-- LM Head -->
  <rect x="140" y="670" width="180" height="32" class="box"/>
  <text x="230" y="688" class="label">W<tspan baseline-shift="sub" font-size="9">lm</tspan> · x</text>
  <text x="230" y="698" class="sublabel">logits</text>
  <text x="332" y="690" class="dim">[V]</text>
  <line x1="230" y1="702" x2="230" y2="720" class="conn"/>

  <!-- Softmax -->
  <rect x="160" y="720" width="140" height="28" class="box"/>
  <text x="230" y="738" class="label">Softmax</text>
  <text x="312" y="738" class="dim">[V]</text>
  <line x1="230" y1="748" x2="230" y2="768" class="conn"/>

  <!-- Output -->
  <text x="230" y="780" class="label" font-size="13" fill="#ccc">P(next char)</text>

  <!-- Footer -->
  <text x="230" y="850" class="sublabel" fill="#444">all intermediates are Value[] — scalar autograd</text>
</svg>
